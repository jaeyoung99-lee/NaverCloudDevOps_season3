<!-- Personal Project -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Find Everything</title>
<link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Jua&family=Lobster&family=Nanum+Pen+Script&family=Permanent+Marker&family=Single+Day&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
<style>
	body * {
		font-family: 'Jua';
	}
	
	.container {
		display: flex;
		margin-left: 10px;
	}
	
	td {
    	text-align: center;
    	vertical-align: middle;
	}

</style>
<script>
	$(function(){
		list("");
		$(".div_tog").hide();
		
		$("#txtword").keyup(function(e){
			let search = e.target.value;
			list(search);
		});
		
		$(document).on("click", ".findLostdel", function(){
			let num = $(this).attr("num");
			let check = confirm("Are you really delete it?");
			if(!check) return;
			
			$.ajax({
				type: "get",
				dataType: "html",
				url: "findLostDelete.jsp",
				data: {"num":num},
				success: function (res) {
					list("");
					$("#txtword").val("");
				},
				statusCode: {
					404: function () {
						alert("Can't find json file!");
					},
					500: function () {
						alert("server error. one more view your code.");
					}
				}
			});
		});
		
		$(document).on("click", ".findLostadd", function(){
			$(".div_tog").toggle('slow');
		});
		
		$(".add").click(function(){
			let name = $("#txtname").val();
			let photo = $("#txtphoto").val();
			let lostplace = $("#txtlostplace").val();
			let lostday = $("#txtlostday").val();
			let money = $("#txtmoney").val();
			alert(photo);
			if(name.length == 0){
				alert("Input name");
				return;
			}
				
			if(photo.length == 0){
				alert("Input photo");
				return;
			}
			
			$("#txtname").val("");
		    $("#txtphoto").val("");
		    $("#txtlostplace").val("");
		    $("#txtlostday").val("");
		    $("#txtmoney").val("");
		    $("#preview").attr("src", "");
			
			$.ajax({
				type: "get",
				dataType: "html",
				data: {"name":name, "photo":photo, "lostplace":lostplace, "lostday":lostday, "money":money},
				url: "findLostAdd.jsp",
				success: function (res) {
					list("");
				},
				statusCode: {
					404: function () {
						alert("Can't find json file!");
					},
					500: function () {
						alert("server error. one more view your code.");
					}
				}
			});
		});
		
	});
	
	function list(search){
		$.ajax({
			type: "get",
			dataType: "json",
			url: "findLostList.jsp",
			data: {"search":search},
			success: function (res) {
				let s = `<table class="table table-striped" style="width: 1000px;">`;
				$.each(res, function(idx, item){
					s +=
					`
					<tr style="text-align: center;">
						<th>
							<span style="font-size: 30px;">이름</span><br><b style="font-size: 20px;">${item.name}</b>
						</th>
						<th>
							<span style="font-size: 30px;">사진</span><br><img src="${item.photo}" style="width: 100px; height: 100px; alt="photo">
						</th>
						<th>
							<span style="font-size: 30px;">잃어버린 장소</span><br><b style="font-size: 20px;">${item.lostplace}</b>
						</th>
						<th>
							<span style="font-size: 30px;">잃어버린 시간</span><br><b style="font-size: 20px;">${item.lostday}</b>
						</th>
						<th>
							<span style="font-size: 30px;">보상금</span><br><b style="font-size: 20px;">${item.money}</b>
						</th>
						<th>							
							<i class = "bi bi-trash findLostdel" style="cursor: pointer; float: right; font-size: 20px;" num="${item.num}"></i>
						</th>
					</tr>
					`;
				});
				
				s += "</table>";
				
				$(".result").html(s);
			},
			statusCode: {
				404: function () {
					alert("Can't find json file!");
				},
				500: function () {
					alert("server error. one more view your code.");
				}
			}
		});
	}
	
	function readURL(input) {
	  if (input.files && input.files[0]) {
	    var reader = new FileReader();
	    reader.onload = function(e) {
	      document.getElementById('preview').src = e.target.result;
	    };
	    reader.readAsDataURL(input.files[0]);
	  }
	  else {
	    document.getElementById('preview').src = "";
	  }
	}
</script>
</head>
<body>
	<div class="container">
	<div style="margin: 10px;">
		<div class="input-group" style="width: 400px;">
			<h5 style="margin-left: 10px; margin-top: 10px;">상품 검색</h5>
			<input type="text" class="form-control" style="width: 150px; margin-left: 20px;" autofocus placeholder="찾고 싶은 분실물 검색" id="txtword">
			<div style="margin-left: 15px; margin-top: 7px;"><i class="bi bi-plus-circle findLostadd" style="cursor: pointer; font-size: 20px; color: red;"></i></div>
		</div>
		<div class="result" style="margin: 10px; font-size: 22px;">
			출력 부분
		</div>
	</div>
	
	<div class="div_tog" style="margin-top: 45px;">
		<table class="table table-striped" style="width: 500px; border: 1px solid black; margin: 20px;">
			<tr>
				<td>
					<b style="font-size: 20px;">이름</b>
				</td>
				<td>
					<input type="text" class="form-control" style="width: 300px; margin-left: 20px;" autofocus placeholder="분실물 이름 입력" id="txtname">
				</td>
			</tr>
			<tr>
				<td>
					<b style="font-size: 20px;">사진</b>
				</td>
				<td>
					<input type="file" class="form-control" style="width: 300px; margin-left: 20px;" autofocus onchange="readURL(this);" id="txtphoto">
					<img id="preview" style="width: 200px; height: 200px; margin-left: 20px; margin-top: 10px;"/>
				</td>
			</tr>
			<tr>
				<td>
					<b style="font-size: 20px;">잃어버린 장소</b>
				</td>
				<td>
					<input type="text" class="form-control" style="width: 300px; margin-left: 20px;" autofocus placeholder="잃어버린 장소 입력" id="txtlostplace">
				</td>
			</tr>
			<tr>
				<td>
					<b style="font-size: 20px;">잃어버린 시간</b>
				</td>
				<td>
					<input type="text" class="form-control" style="width: 300px; margin-left: 20px;" autofocus placeholder="잃어버린 시간 입력" id="txtlostday">
				</td>
			</tr>
			<tr>
				<td>
					<b style="font-size: 20px;">보상금</b>
				</td>
				<td>
					<input type="text" class="form-control" style="width: 300px; margin-left: 20px;" autofocus placeholder="보상금 입력" id="txtmoney">
				</td>
			</tr>
			<tr>
				<td colspan="2" style="text-align: center;" class="add">
				<b style="font-size: 20px; cursor: pointer;">추가</b>
			</tr>
		</table>
	</div>
	</div>
</body>
</html>